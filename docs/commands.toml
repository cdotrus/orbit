# ------------------------------------------------------------------------------
# new             
# ------------------------------------------------------------------------------
[new]
name = "new"
summary = "create a new ip"
synopsis = "orbit new [options] <path>"
description = """
Creates a new ip at the target directory `<path>`. The path is assumed to not
already exist. A new directory will be created at the file system destination
that contains a minimal manifest and .orbitignore file.

If no name is supplied, then the ip's name defaults to the final directory name
taken from `<path>`. Using the `--name` option allows this field to be
explicitly set.

For initializing an already existing project into an ip, see the `init` 
command.
"""

args."<path>" = "Directory to create for the ip"

options."--name <name>" = "Set the resulting ip's name"
options."--lib <lib>" = "Set the resulting ip's library"

examples = """
orbit new gates
orbit new eecs/lab1 --name adder
"""

# ------------------------------------------------------------------------------
# init      
# ------------------------------------------------------------------------------
[init]
name = "init"
summary = "initialize an ip from an existing project"
synopsis = "orbit init [options] [<path>]"
description = """
Initializes an ip at the file system directory `<path>`. If not path is
provided, then it defaults to the current working directory. 

If no name is provided, then the resulting ip's name defaults to the 
directory's name. Using the `--name` option allows the ip's name to be 
explicitly set.

To create a new ip from a non-existing directory, see the `new` command.
"""

options."<path>" = "Directory to initialize"
options."--name <name>" = "Set the resulting ip's name"
options."--lib <lib>" = "Set the resulting ip's library"

examples = """
orbit init
orbit init projects/gates
orbit init --name adder
"""

# ------------------------------------------------------------------------------   
# view           
# ------------------------------------------------------------------------------
[view]
name = "view"
summary = "display metadata of an ip"
synopsis = "orbit view [options] [<ip>]"
description = """
Displays various bits of information about a particular ip. If no ip is
provided, then it displays information related to the local ip.

To display manifest information, no additional options are required.

To display the defined HDL design elements within the ip, use the `--units`
option. For non-local ip, its protected and private design elements are hidden
from the results. To display design elements of all visibility levels the
`--all` option must also be present.

To display the known versions for an ip, use the `--versions` option.
"""

options."<ip>" = "Ip specification"
options."--versions, -v" = "Display the list of known versions"
options."--units, -u" = "Display the HDL design elements defined for this ip"
options."--all, -a" = "Include any private or hidden results"

examples = """
orbit view --units
orbit view gates:1.0.0 -u --all
orbit view gates --versions
orbit view gates:1 -v
"""

# ------------------------------------------------------------------------------
# read          
# ------------------------------------------------------------------------------
[read]
name = "read"
summary = "lookup hdl source code"
synopsis = "orbit read [options] <unit>"
description = """
Navigates hdl source code to lookup requested hdl code snippets. Looking up
hdl source code to see its implementation can help gain a better understanding
of the code being reused in your current design.

By default, the resulting code is displayed to the console. To write the
results to a file for improved readability, use the `--save` option. Combining 
the `--locate` option with the `--save` option will append the line and column
number of the identified code snippet to the end of the resulting file path.

If no ip is provided by the `--ip` option, then it will assume to search the
local ip for the provided design unit.

The values for options `--start`, `--end`, and `--doc` must be valid hdl code. 
The code is interpreted in the native language of the provided design unit.

The `--doc` option will attempt to find the comments immediately preceding the
identified code snippet. 

Every time this command is called, it attempts to clean the temporary
directory where it saves resulting files. To keep existing files on the next
call of this command, use the `--no-clean` option.
"""

args."<unit>" = "Read the file for this hdl design unit"

options."--ip <spec>" = "Ip specification"
options."--doc <code>" = "Find the preceding comments to the code snippet"
options."--save" = "Write the results to a temporary read-only file"
options."--start <code>" = "Start the lookup after jumping to this code snippet"
options."--end <code>" = "Stop the lookup after finding this code snippet"
options."--limit <num>" = "Set a maximum number of source code lines to write"
options."--no-clean" = "Do not clean the temporary directory of existing files"
options."--locate" = "Append the line and column number to the resulting file"

examples = """
orbit read and_gate --limit 25
orbit read math_pkg --ip math --doc "function clog2" --start "package math_pkg"
orbit read math_pkg --ip math --doc "function flog2p1" --save --locate
"""

# ------------------------------------------------------------------------------ 
# get      
# ------------------------------------------------------------------------------
[get]
name = "get"
summary = "fetch an hdl entity for code integration"
synopsis = "orbit get [options] <unit>"
description = """
This command will provide the relevant information about the requested HDL 
entity required to integrate the code into the current design. The command
produces valid HDL code displayed to stdout that allows a user to copy and
paste the results into a new hdl source code file for proper hierarchy code
reuse.

If the spec if not provided with `--ip`, then it will search the current
working ip for the requested HDL entity.

If the `--instance` flag is used without the `--component` flag, then it will
display the direct instantiation style code for VHDL (VHDL-93 feature).

It is important to note that any units referenced from ip outside of the
current working ip are not automatically tracked as a dependency. In order to
add an ip as a dependency to properly reference its source code files, edit
the current working ip's manifest with a new entry under the `[dependencies]`
table with the dependency ip and its version.

An identifier prefix or suffix can be attached to the signal declarations and
the instantiation's port connection signals by using `--signal-prefix` and 
`--signal-suffix` respectively. These optional texts are treated as normal
strings and are not checked for correct syntax.

When no output options are specified, this command by default will display the
entity's component declaration.
"""

args."<unit>" = "Primary design unit identifier"
options."--ip <spec>" = "The ip that contains the requested unit"
options."--json" = "Export the entity information as valid json"
options."--library, -l" = "Display the unit's library declaration"
options."--component, -c" = "Display the component declaration"
options."--signals, -s" = "Display the constant and signal declarations"
options."--instance, -i" = "Display the unit's instantiation"
options."--architecture, -a" = "Display the detected architectures"
options."--name <identifier>" = "Set the instance's identifier"
options."--signal-prefix <value>" = "Prepend information to the instance's signals"
options."--signal-suffix <value>" = "Append information to the instance's signals"

examples = """
orbit get and_gate --ip gates:1.0.0 --component
orbit get ram --ip mem:2.0.3 -csi
orbit get uart -si --name u0
orbit get or_gate --ip gates --json
"""

# ------------------------------------------------------------------------------     
# tree    
# ------------------------------------------------------------------------------
[tree]
name = "tree"
summary = "view the dependency graph"
synopsis = "orbit tree [options]"
description = """
This command will show the hierarchical tree-structure starting from a node.
By default, it will attempt to automatically detect the root if it is
unambiguous and `--root` is not provided. This command only works when called
from the current working ip.

The hdl-level tree displays the connections between entities. The hdl tree does 
not show how many times an entity is instantiated within a parent entity, and 
all architectures for each entity are analyzed. If an unidentified entity is 
instantiated it will appear as a leaf and is denoted as a black box by a '?' 
character.

An entity is considered a black box if it cannot find that referenced entity's 
hdl source code file.

To view the dependency tree at the ip-level, use `--ip`.
"""

options."--root <unit>" = "The uppermost hdl unit to start the dependency tree"
options."--compress" = "Replace duplicate branches with a label marking"
options."--all" = "Include all possible roots in the tree"
options."--format <fmt>" = "Determine how to display nodes ('long', 'short')"
options."--ascii" = "Limit the textual tree characters to the 128 ASCII set"
options."--ip" = "View the dependency graph at the ip level"

examples = """
orbit tree --ip
orbit tree --root top --format long
orbit tree --ascii --all
"""

# ------------------------------------------------------------------------------  
# lock     
# ------------------------------------------------------------------------------
[lock]
name = "lock"
summary = "save the world state of an ip"
synopsis = "orbit lock [options]"
description = """
This command saves the state of the world according to the working ip. To
accomplish this, Orbit reads working ip's manifest file to resolve any
missing dependencies. It's writes all the information that is necessary to
reproduce this state to the ip's lock file, Orbit.lock.

This command can only be ran within a working ip.

It is encouraged to check the lock file into version control such that others
trying to build the ip can reproduce the ip's current state. The lock file
should not be manually edited by the user.

To capture the state of the world according to the ip, this command will
download and install any unresolved dependencies. If an installed dependency's 
computed checksum does not match the checksum stored in the lock file, it 
assumes the installation to be corrupt and will re-install the dependency to 
the cache.
"""

options."--force" = "Ignore reading the precomputed lock file"

examples = """
orbit lock
orbit lock --force
"""

# ------------------------------------------------------------------------------
# test      
# ------------------------------------------------------------------------------
[test]
name = "test"
alias = "t"
summary = "run a test"
synopsis = "orbit test [options] [--] [args]..."
description = """
This command prepares a given target and then executes the target.

While this command functions similar to `orbit build`, the targets that are 
encouraged to be used with this command are ones that are designed to either
"pass" or "fail", typically through a return code. This command requires a
testbench, if you do not want to set a testbench, see `orbit build`.

A target must be provided for the test command to run. A default target can
be specified in a configuration file, which will be used when a target is
omitted from the command-line.

If `--list` is used, then it will display a list of the available targets to
the user. Using `--list` in combination with a target from `--target` will
display any detailed help information the target has documented in its 
definition.

A target typically goes through three steps for the testing process:  
   1. Parse the blueprint file  
   2. Process the referenced files listed in the blueprint  
   3. Verify the hdl source code passes all tests

Any command-line arguments entered after the terminating flag `--` will be
passed in the received order as arguments to the subprocess's command. If a 
target already has defined arguments, the additional arguments passed from the 
command-line will follow the previously defined arguments.

The target's process will spawn from the current working ip's output directory,
which is $ORBIT_TARGET_DIR/$ORBIT_TARGET.
"""

options."--target <name>" = "Target to execute"
options."--dut <unit>" = "Set the device under test"
options."--tb <unit>" = "Set the top level testbench unit"
options."--plan <format>" = "Set the blueprint file format"
options."--target-dir <dir>" = "The relative directory where the target starts"
options."--command <path>" = "Overwrite the target's command"
options."--list" = "View available targets and exit"
options."--all" = "Include all hdl files of the working ip"
options."--fileset <key=glob>..." = "A glob-style pattern identified by name to include in the blueprint"
options."--no-clean" = "Do not clean the target folder before execution"
options."--force" = "Force the target to execute "
options."--verbose" = "Display the command being executed"
options."args" = "Arguments to pass to the target"

examples = """
orbit test --dut adder --tb adder_tb --target modelsim -- --lint
"""

# ------------------------------------------------------------------------------
# build, b       
# ------------------------------------------------------------------------------
[build]
name = "build"
alias = "b"
summary = "plan and execute a target"
synopsis = "orbit build [options] [--] [args]..."
description = """
This command prepares a given target and then executes the target.

While this command functions similar to `orbit test`, the targets that are 
encouraged to be used with this command are ones that produce artifacts at the
end of their execution process. This command does not allow the top to be a
testbench, if you want to set a testbench, see `orbit test`.

A target must be provided for the build command to run. A default target can
be specified in a configuration file, which will be used when a target is
omitted from the command-line.

If `--list` is used, then it will display a list of the available targets to
the user. Using `--list` in combination with a target from `--target` will
display any detailed help information the target has documented in its 
definition.

A target typically goes through three steps for the building process:  
   1. Parse the blueprint file  
   2. Process the referenced files listed in the blueprint  
   3. Generate a artifact(s)

Any command-line arguments entered after the terminating flag `--` will be
passed in the received order as arguments to the subprocess's command. If a 
target already has defined arguments, the additional arguments passed from the 
command-line will follow the previously defined arguments.

The target's process will spawn from the current working ip's output directory,
which is $ORBIT_TARGET_DIR/$ORBIT_TARGET.
"""

options."--target <name>" = "Target to execute"
options."--top <unit>" = "Set the top level design unit"
options."--plan <format>" = "Set the blueprint file format"
options."--target-dir <dir>" = "The relative directory where the target starts"
options."--command <path>" = "Overwrite the target's command"
options."--list" = "View available targets and exit"
options."--all" = "Include all hdl files of the working ip"
options."--fileset <key=glob>..." = "A glob-style pattern identified by name to include in the blueprint"
options."--force" = "Force the target to execute "
options."--no-clean" = "Do not clean the target folder before execution"
options."--verbose" = "Display the command being executed"
options."args" = "Arguments to pass to the target"

examples = """
orbit build --target xsim -- --elab
orbit build --command python3 --target pysim
orbit build --all --target-dir build --target ghdl
orbit build --target xsim --force -- --help
"""

# ------------------------------------------------------------------------------
# publish          
# ------------------------------------------------------------------------------
[publish]
name = "publish"
summary = "post an ip to a channel"
synopsis = "orbit publish [options]"
description = """
Performs a series of checks on a local ip and then releases it to its specified
channel(s).

There are multiple checks that are performed before an ip can be published. The
ip must have an up to date lockfile with no relative dependencies. The ip's
manifest must also have a value for the source field. Lastly, Orbit must be
able to construct the hdl source code graph without errors.

Posting an ip to a channel involves copying the ip's manifest file to a path 
within the channel known as the index. For every publish of an ip, the index 
corresponds to a unique path within the channel that gets created by Orbit.

By default, it operates a dry run, performing all steps in the process except
for posting the ip to its channel(s). To fully run the command, use the
`--ready` flag. When the ip is published, it will also be installed to the cache
by default. To skip this behavior, use the `--no-install` flag.
"""

options."--ready, -y" = "Perform a full run"
options."--list" = "View available channels and exit"

examples = """
orbit publish
orbit publish --ready
"""

# ------------------------------------------------------------------------------
# search          
# ------------------------------------------------------------------------------
[search]
name = "search"
summary = "browse the ip catalog"
synopsis = "orbit search [options] [<ip>]"
description = """
This command will display a list of all the known ip in the catalog. The catalog
consists of 3 levels: cache, downloads, and channels.

Any ip at the cache level are considered installed. Any ip at the downloads
level are considered downloaded. Any ip at the channels level is considered
available. An ip does not exist in the catalog if it is not found at any one
of the three defined levels.

When a package name is provided for `<ip>`, it will begin to partially match 
the name with the names of the known ip. If an ip's name begins with `<ip>`, it
is included in the filtered resultes. To strictly match the argument against an
ip name, use `--match`.
"""

options."<ip>" = "The beginning of a package name"
options."--install, -i" = "Filter ip installed to the cache"
options."--download, -d" = "Filter ip downloaded to the downloads"
options."--keyword <term>..." = "Include ip that contain this keyword"
options."--limit <num>" = "The maximum number of results to return"
options."--match" = "Return results that only pass each filter"

examples = """
orbit search axi
orbit search --keyword memory --keyword ecc
orbit search --keyword RF --limit 20
"""

# ------------------------------------------------------------------------------
# download        
# ------------------------------------------------------------------------------
# [download]
# name = "download"
# summary = "fetch packages from the internet"
# synopsis = "orbit download [options]"
# description = """
# This command will get a package from the internet using the default protocol
# or a user-defined protocol. It places the package in the path defined as
# environment variable `$ORBIT_ARCHIVE`.

# Downloads are vital to Orbit's management system as to avoid having to solely 
# rely on accessing the internet to get IP. Downloads allow Orbit to quickly
# repair broken installations and allow users to learn about IP before installing.

# When using a custom protocol, Orbit expects the final fetched repository to
# exist within a special directory called the queue. By default, the queue is set
# to a temporary directory, but it can be overridden with `--queue`. After a 
# protocol is executed, Orbit resumes the download process by trying to detect the 
# target IP and then performing a compression algorithm on the path to store as a 
# single file archive. This final archive is special and packed with additional 
# bytes, which makes it unsuitable to easily unzip with existing compression 
# tools.

# A lockfile is required to exist in the current IP in order to download its 
# dependencies.

# Variable substitution is supported when specifying the "command" and "args"
# fields for a protocol. Most notably, the queue is accessed as 
# `{{ orbit.queue }}`. See `orbit help protocols` for more information about 
# available variables.

# This action may automatically run during an install if the package is missing
# from the downloads. See `orbit help install` for more details.
# """

# options."--list" = "Print URLs and exit"
# options."--missing" = "Filter only uninstalled packages (default: true)"
# options."--all" = "Gather packages from all dependency types"
# options."--queue <dir>" = "Set the destination directory for placing fetched repositories"
# options."--verbose" = "Display the custom protocol being executed"
# options."--force" = "Download selected packages regardless of status"

# examples = """
# orbit download --missing --list
# orbit download --all --force
# """

# ------------------------------------------------------------------------------
# install         
# ------------------------------------------------------------------------------
[install]
name = "install"
summary = "store an immutable reference to an ip"
synopsis = "orbit install [options]"
description = """
This command will place an ip into the cache. By default, the specified version
is the 'latest' released version orbit can identify.

When this command is ran without specifying the <ip> or a source (such as
`--url` or `--path`), it will attempt to install the current working ip, if it
exists.

By default, any dependencies required only for development by the target ip are
omitted from installation. To also install these dependencies, use `--all`.

If a protocol is recognized using `--protocol`, then an optional tag can also 
be supplied to help the protocol with providing any additional information it
may require. 

To remove ip from the catalog, see the `remove` command.
"""

options."<ip>" = "Ip specification"
options."--url <url>" = "URL to install the ip from the internet"
options."--path <path>" = "Path to install the ip from local file system"
options."--protocol <name>" = "Use a configured protocol to download ip"
options."--tag <tag>" = "Unique tag to provide to the protocol"
options."--force" = "Install the ip regardless of the cache slot occupancy"
options."--list" = "View available protocols and exit"
options."--all" = "Install all dependencies (including development)"

examples = """
orbit install
orbit install lcd_driver:2.0
orbit install adder:1.0.0 --url https://my.adder/project.zip
orbit install alu:2.3.7 --path ./projects/alu --force 
"""

# ------------------------------------------------------------------------------
# remove      
# ------------------------------------------------------------------------------
[remove]
name = "remove"
summary = "delete an ip from the catalog"
synopsis = "orbit remove [options] <ip>"
description = """
Deletes save data for a known ip from the catalog. The ip's data for its
particular version is removed from the catalog's cache and the catalog's
archive.

By default, an interactive prompt will appear to confirm with the user if the 
correct ip is okay to be removed. To skip this interactive prompt and assume
it is correct without confirmation, use the `--force` option.

To add ip to the catalog, see the `install` command.
"""

args."<ip>" = "ip specification"

# options."--recurse, -r" = "Also remove the ip's dependencies"
options."--force" = "Skip interactive prompts"
options."--verbose" = "Display where the removal occurs"

examples = """
orbit remove gates
orbit remove gates:1.0.1 --force
"""

# ------------------------------------------------------------------------------
# env             
# ------------------------------------------------------------------------------
[env]
name = "env"
summary = "print orbit environment information"
synopsis = "orbit env [options]"
description = """
This command prints environment variables relevant to `orbit`.

By default, this command prins information as a shell script. If one or more
variable names are given as arguments as `<key>`, then it will print the value
of each provided variables on its own line.
"""

options."<key>..." = "Include this variable's value specifically in the environment information"

examples = """
orbit env
orbit env ORBIT_HOME
orbit env ORBIT_CACHE ORBIT_ARCHIVE
"""

# ------------------------------------------------------------------------------
# config          
# ------------------------------------------------------------------------------
[config]
name = "config"
summary = "modify configuration values"
synopsis = "orbit config [options]"
description = """
This command will alter configuration entries in Orbit's settings file named 
`config.toml`. By default, it will modify the user's config file found at
the path read from the environment variable `$ORBIT_HOME`.
  
To access an entry (key/value pair), use dots (`.`) to delimit between 
intermediate table identifiers and the final key identifier.

The command modifies the document in three independent stages. The first stage
modifies the settings by iterating through all defined `--append` values. Then, 
it will insert all `--set` values. Lastly, it will remove all `--unset` entries.
"""

options."--global" = "Access the home configuration file"
options."--local" = "Access the current project's configuration file"
options."--append <key=value>..." = "Add a value to the key storing a list"
options."--set <key=value>..." = "Write the value at the key's entry"
options."--unset <key>..." = "Delete the key's entry"

examples = """
orbit config --append include="~/.orbit/profiles/ks-tech"
orbit config --unset env.VIVADO_PATH --global
"""

# ------------------------------------------------------------------------------
# orbit      
# ------------------------------------------------------------------------------
[orbit]
summary = "orbit is an hdl package manager and build tool"
synopsis = "orbit [options] [command]"

options."--version" = "Print version information and exit"
options."--upgrade" = "check for the latest orbit binary"
options."--sync" = "synchronize configured channels"
options."--force" = "bypass interactive prompts"
options."--color <when>" = "coloring: auto, always, never"
options."--help, -h" = "print help information"
